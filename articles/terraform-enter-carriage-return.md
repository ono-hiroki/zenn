---
title: "Terraformで Enter を押しても ^M が表示されて進まない問題の解決方法"
emoji: "🏗️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Terraform", "Terminal", "Linux", "macOS"]
published: true
---

`terraform apply` で `yes` を入力して Enter を押したのに、`^M` が表示されて処理が進まない。そんな現象に遭遇したときの原因と解決方法を紹介します。

## 現象

Terraform の `apply` や `destroy` で確認プロンプトが表示され、`yes` と入力して Enter を押すと、`^M` が表示されて処理が進まない。

```text
  Enter a value: yes^M
```

何度 Enter を押しても `^M` が追加されるだけで、コマンドが実行されない状態になります。

## 原因

ターミナルの `icrnl` 設定が無効になっていることが原因です。

`icrnl` は「入力時に CR（キャリッジリターン）を LF（ラインフィード）に変換する」フラグです。これが無効だと、Enter キーで送られる CR がそのまま `^M` として表示され、プログラムが期待する LF（改行）が送られません。

以下のコマンドで現在の設定を確認できます：

```bash
stty -a | grep icrnl
```

出力に `-icrnl` と表示されていれば無効になっています（`-` は無効を意味します）。

```text
# 無効の場合
-icrnl

# 有効の場合（正常）
icrnl
```

## 解決方法

`icrnl` を有効にします：

```bash
stty icrnl
```

または、ターミナル設定を一括でデフォルトに戻す方法もあります：

```bash
stty sane
```

## なぜこの状態になるのか

この問題は、異常終了したプログラムがターミナル設定を元に戻さなかった場合に発生することがあります。例えば、`Ctrl+C` で強制終了したプログラムや、クラッシュしたプロセスが原因となることがあります。

頻発するようであれば、シェルの設定ファイル（`~/.bashrc` や `~/.zshrc`）に以下を追加しておくと安心です：

```bash
stty icrnl
```
